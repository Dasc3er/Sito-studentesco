$(document).ready(function(){function i(i,a,t){var s=a.row(i),n=t.row.add(s.data()).draw().node();return s.remove().draw(),e(),n}function a(i){return"undefined"==typeof i}function e(){0===l.data().length&&0===f.data().length&&0===p.data().length?$("#iscrizioni").addClass("hidden"):$("#iscrizioni").removeClass("hidden")}$(".page-wrap").css("margin-bottom",-$(".footer").height()),$("<style>.page-wrap:after{height:"+$(".footer").height()+"px}</style>").appendTo("head");var t="/edsa-Autogestione",s={bLengthChange:!1,paging:!0,ordering:!0,info:!0,responsive:!0,language:{decimal:",",zeroRecords:"Nessun risultato :(",info:"Pagina _PAGE_ di _PAGES_",infoEmpty:"",infoFiltered:"",emptyTable:"Nessun risultato :(",infoPostFix:"",thousands:".",loadingRecords:"Caricamento...",processing:"Elaborazione...",search:"Ricerca:",paginate:{first:"Prima",last:"Ultima",next:"Successivo",previous:"Precedente"},aria:{sortAscending:"Ordinamento alfabetico",sortDescending:"Ordinamento inverso"}},order:[1,"desc"],columns:[null,{visible:!1},{visible:!1},{visible:!1}]},n={bLengthChange:!1,bFilter:!1,paging:!1,ordering:!0,info:!1,language:{emptyTable:"Nessun risultato :("},responsive:!0,columns:[null,{visible:!1},{visible:!1},{visible:!1}]},r=$("#iscritto").DataTable(s),o=$("#good").DataTable(s),d=$("#blocked").DataTable(s),c=$("#to").DataTable(s),l=$("#primo").DataTable(n),f=$("#secondo").DataTable(n),p=$("#terzo").DataTable(n),h=$("#first").DataTable(s),v=$("#second").DataTable(s),u=$("#third").DataTable(s),m="primo turno",b="secondo turno",g="giornata intera (torneo)";$(".scroll").DataTable({paging:!0,ordering:!0,info:!0,responsive:!0,language:{decimal:",",lengthMenu:"_MENU_ risultati per pagina",zeroRecords:"Nessun risultato :(",info:"_TOTAL_ risultati",infoEmpty:"",infoFiltered:"(filtrato da _MAX_ risultati totali)",emptyTable:"Nessun risultato :(",infoPostFix:"",thousands:".",loadingRecords:"Caricamento...",processing:"Elaborazione...",search:"Ricerca:",paginate:{first:"Prima",last:"Ultima",next:"Successivo",previous:"Precedente"},aria:{sortAscending:"Ordinamento alfabetico",sortDescending:"Ordinamento inverso"}},scrollY:400,scrollCollapse:!0,paging:!1}),$(document).on("tap","#professore",function(){$(this).parent().parent().find(".active").removeClass("active"),$(this).parent().addClass("active");var i=$(this).find("#nome").text(),a=".";i&&"Tutti i professori"!=i?(a="^\\s*"+$(this).find("#nome").text()+"\\s*$",$("#who").text("di "+$(this).find("#nome").text())):$("#who").text(""),c.columns(2).search(a,!0).draw(),o.columns(2).search(a,!0).draw(),d.columns(2).search(a,!0).draw()}),$(document).on("tap","#sort",function(){$(this).parent().parent().find(".active").removeClass("active"),$(this).parent().addClass("active");var i,a=$(this).find("#val").text().toLowerCase();i="1"==a?[1,"asc"]:"1d"==a?[1,"desc"]:"2"==a?[2,"asc"]:"2d"==a?[2,"desc"]:"3"==a?[3,"asc"]:"3d"==a?[3,"desc"]:[0,"asc"],r.order(i).draw(),o.order(i).draw(),d.order(i).draw(),c.order(i).draw(),l.order(i).draw(),f.order(i).draw(),p.order(i).draw(),h.order(i).draw(),v.order(i).draw(),u.order(i).draw()}),$(document).on("tap","#reset",function(){var i=$(this);i.html('<i class="fa fa-circle-o-notch fa-spin"></i>'),$.ajax({method:"GET",url:t+"/utenti/reset/"+i.parent().find("#value").text(),data:{ajax:!0}}).done(function(a){i.parent().html(a)})}),$(document).on("tap","#presenza",function(){var i=$(this);i.html('<i class="fa fa-circle-o-notch fa-spin"></i>'),i.removeClass("btn-success"),i.removeClass("btn-danger"),i.addClass("btn-info"),$.ajax({method:"GET",url:t+"presente/"+i.parent().find("#persona").text()+"/"+$("#value").text(),data:{ajax:!0}}).done(function(a){1==a?(i.addClass("btn-danger"),i.removeClass("btn-info"),i.parent().parent().find("#pres").html("Attualmente presente"),i.html("Assente")):0==a&&(i.removeClass("btn-info"),i.addClass("btn-success"),i.parent().parent().find("#pres").html("Attualmente assente"),i.html("Presente"))})}),$(document).on("tap","#like",function(){var i=$(this),a=$(this).parent().parent().parent();i.find("#text").html('<i class="fa fa-circle-o-notch fa-spin"></i>'),i.removeClass("btn-success").removeClass("btn-danger").addClass("btn-info disabled");var e=t+"/";"proposte"==$("#page").text().toLowerCase()?e+="proposte":"citazioni"==$("#page").text().toLowerCase()&&(e+="citazioni"),e+="/"+a.find("#value").text(),$.ajax({method:"GET",url:e,data:{ajax:!0}}).done(function(e){1==e?(i.removeClass("btn-info disabled").addClass("btn-danger").find("#text").html('<i class="fa fa-thumbs-o-up"></i>'),a.parent().parent().find("#cont").text(parseInt(i.parent().find("#cont").text())+1)):0==e&&(i.removeClass("btn-info disabled").addClass("btn-success").find("#text").html('<i class="fa fa-thumbs-o-up"></i>'),a.parent().parent().find("#cont").text(parseInt(i.parent().find("#cont").text())-1))})}),e(),$(document).on("tap","#iscriviti",function(){var e=$(this),s=$(this).parent().parent().parent().parent().parent(),n=s.find("#orario").text().toLowerCase();e.removeClass("btn-success").removeClass("btn-danger").addClass("btn-info disabled").html('<i class="fa fa-circle-o-notch fa-spin"></i>');var d=t+"/";"corsi"==$("#page").text().toLowerCase()?d+="corsi":"aula"==$("#page").text().toLowerCase()&&(d+="aule"),d+="/"+s.find("#value").text(),$.ajax({method:"GET",url:d,data:{ajax:!0}}).done(function(e){var d;1==e?(n&&"corsi"==$("#page").text().toLowerCase()?(n==m?(d=i(s,h,l),$("#first").find("#iscriviti").parent().remove(),$("#third").find("#iscriviti").parent().remove()):n==b?(d=i(s,v,f),$("#second").find("#iscriviti").parent().remove(),$("#third").find("#iscriviti").parent().remove()):n==g?(d=i(s,u,p),$(d).find(".links").append('<li><a id="sqaud" href="'+t+'/squadra" class="btn btn-primary btn-lg">Crea squadra</a></li>'),$("#first").find("#iscriviti").parent().remove(),$("#second").find("#iscriviti").parent().remove(),$("#third").find("#iscriviti").parent().remove()):d=i(s,o,sub),$(d).find("#orario").parent().parent().removeClass("hidden")):n==g&&$(d).find(".links").append('<li><a id="sqaud" href="'+t+'/squadra" class="btn btn-primary btn-lg">Crea squadra</a></li>'),a($(d).find("#iscriviti").html())?$(d).find(".links").prepend('<li><a id="iscriviti" class="btn btn-success"><i class="fa fa-close"> Elimina iscrizione</a></li>'):$(d).find("#iscriviti").removeClass("btn-success").addClass("btn-danger").html('<i class="fa fa-close"></i> Elimina iscrizione'),$(d).find("#number").text(parseInt(s.find("#number").text())+1),$(d).find("#stato").removeClass("btn-success").addClass("btn-warning").html('<i class="fa fa-eye-slash"></i> Blocca')):0==e&&(n&&"corsi"==$("#page").text().toLowerCase()&&(n==m?($("#first").find("section").not(".yellow").find(".links").prepend('<li><a id="iscriviti" class="btn btn-success"><i class="fa fa-check"></i> Iscriviti</a></li></li>'),0===f.data().length&&$("#third").find("section").not(".yellow").find(".links").prepend('<li><a id="iscriviti" class="btn btn-success"><i class="fa fa-check"></i> Iscriviti</a></li>'),d=i(s,l,h)):n==b?($("#second").find("section").not(".yellow").find(".links").prepend('<li><a id="iscriviti" class="btn btn-success"><i class="fa fa-check"></i> Iscriviti</a></li>'),0===l.data().length&&$("#third").find("section").not(".yellow").find(".links").prepend('<li><a id="iscriviti" class="btn btn-success"><i class="fa fa-check"></i> Iscriviti</a></li>'),d=i(s,f,v)):n==g?($("#first").find("section").not(".yellow").find(".links").prepend('<li><a id="iscriviti" class="btn btn-success"><i class="fa fa-check"></i> Iscriviti</a></li>'),$("#second").find("section").not(".yellow").find(".links").prepend('<li><a id="iscriviti" class="btn btn-success"><i class="fa fa-check"></i> Iscriviti</a></li>'),$("#third").find("section").not(".yellow").find(".links").prepend('<li><a id="iscriviti" class="btn btn-success"><i class="fa fa-check"></i> Iscriviti</a></li>'),d=i(s,p,u)):d=i(s,r,o),$(d).find("#orario").parent().parent().addClass("hidden")),a($(d).find("#iscriviti").html())?$(d).find(".links").prepend('<li><a id="iscriviti" class="btn btn-danger"><i class="fa fa-check"></i> Iscriviti</a></li>'):$(d).find("#iscriviti").removeClass("btn-danger").addClass("btn-success").html('<i class="fa fa-check"></i> Iscriviti'),$(d).find("#number").text(parseInt(s.find("#number").text())-1),$(d).find("#squad").parent().remove(),$(d).find("#stato").removeClass("btn-success").addClass("btn-warning").html('<i class="fa fa-eye-slash"></i> Blocca')),$(d).find(".progress-bar").attr("aria-valuenow",100*parseInt(s.find("#number").text())/parseInt(s.find("#max").text())),$(d).find(".progress-bar").css("width",100*parseInt(s.find("#number").text())/parseInt(s.find("#max").text())+"%")})}),$(document).on("tap","#stato",function(){var e=$(this),s=$(this).parent().parent().parent().parent().parent(),n=s.find("#orario").text().toLowerCase();e.removeClass("btn-success").removeClass("btn-warning").addClass("btn-info disabled").html('<i class="fa fa-circle-o-notch fa-spin"></i>');var r=t+"/cambia/";"corsi"==$("#page").text().toLowerCase()?r+="corso":"proposte"==$("#page").text().toLowerCase()?r+="proposta":"aula"==$("#page").text().toLowerCase()?r+="aula":"citazioni"==$("#page").text().toLowerCase()?r+="citazione":"tipologie"==$("#page").text().toLowerCase()?r+="tipo":"categorie"==$("#page").text().toLowerCase()?r+="categoria":"articoli"==$("#page").text().toLowerCase()?r+="articolo":"post"==$("#page").text().toLowerCase()&&(r+="post"),r+="/"+s.find("#value").text(),$.ajax({method:"GET",url:r,data:{ajax:!0}}).done(function(e){var t;1==e?(n?(n==m?s.find("#orario").parent().parent().hasClass("hidden")?t=i(s,h,d):($("#first").find("section").not(".yellow").find(".links").prepend('<li><a id="iscriviti" class="btn btn-success"><i class="fa fa-check"> Iscriviti</a></li>'),0===f.data().length&&$("#third").find("section").find(".links").prepend('<li><a id="iscriviti" class="btn btn-success"><i class="fa fa-check"> Iscriviti</a></li>'),t=i(s,l,d)):n==b?s.find("#orario").parent().parent().hasClass("hidden")?t=i(s,v,d):($("#second").find("section").not(".yellow").find(".links").prepend('<li><a id="iscriviti" class="btn btn-success"><i class="fa fa-check"> Iscriviti</a></li>'),0===l.data().length&&$("#third").find("section").find(".links").prepend('<li><a id="iscriviti" class="btn btn-success"><i class="fa fa-check"> Iscriviti</a></li>'),t=i(s,f,d)):n==g&&(s.find("#orario").parent().parent().hasClass("hidden")?t=i(s,u,d):($("#first").find("section").not(".yellow").find(".links").prepend('<li><a id="iscriviti" class="btn btn-success"><i class="fa fa-check"> Iscriviti</a></li>'),$("#second").find("section").not(".yellow").find(".links").prepend('<li><a id="iscriviti" class="btn btn-success"><i class="fa fa-check"> Iscriviti</a></li>'),$("#third").find("section").not(".yellow").find(".links").prepend('<li><a id="iscriviti" class="btn btn-success"><i class="fa fa-check"> Iscriviti</a></li>'),t=i(s,p,d))),$(t).find("#orario").parent().parent().removeClass("hidden")):t=i(s,o,d),$(t).find("#stato").removeClass("btn-warning").addClass("btn-success").html('<i class="fa fa-eye"></i> Abilita'),$(t).find("#squad").parent().remove(),$(t).find("#like").parent().remove(),$(t).find(".level").remove(),$(t).find("#iscriviti").parent().remove()):0==e&&(n?(n==m?t=i(s,d,h):n==b?t=i(s,d,v):n==g&&(t=i(s,d,u)),$(t).find("#orario").parent().parent().addClass("hidden"),n=$(t).find("#orario").text().toLowerCase(),$(t).find("section").not(".yellow")&&(n==m&&0===l.data().length&&0===p.data().length||n==b&&0===f.data().length&&0===p.data().length||n==g&&0===l.data().length&&0===f.data().length&&0===p.data().length?a($(t).find("#iscriviti").html())?$(t).find(".links").prepend('<li><a id="iscriviti" class="btn btn-success"><i class="fa fa-check"> Iscriviti</a></li>'):$(t).find("#iscriviti").removeClass("btn-danger").addClass("btn-success").html('<i class="fa fa-check"></i> Iscriviti'):$(t).find("#iscriviti")&&$(t).find("#iscriviti").parent().remove())):(t="to"==s.parent().parent().attr("id")?i(s,c,o):i(s,d,o),"post"!=$("#page").text().toLowerCase()&&"articoli"!=$("#page").text().toLowerCase()&&"categorie"!=$("#page").text().toLowerCase()&&"tipologie"!=$("#page").text().toLowerCase()&&a($(t).find("#like").html())&&$(t).find(".links").prepend('<li><a id="like" class="btn btn-success"><span id="text"><i class="fa fa-thumbs-o-up"></i></span> <span id="cont">0</span></a></li>')),$(t).find("#stato").removeClass("btn-success").addClass("btn-warning").html('<i class="fa fa-eye-slash"></i> Blocca'),$(t).find("#dis").remove()),$(t).find("#cambia").parent().remove()})}),$(document).on("tap","#cambia",function(){var a=$(this),e=a.parent().parent().parent().parent().parent();a.html('<i class="fa fa-circle-o-notch fa-spin"></i>').addClass("disabled");var s=t+"/rifiuta/";"proposte"==$("#page").text().toLowerCase()?s+="proposta":"aula"==$("#page").text().toLowerCase()?s+="aula":"citazioni"==$("#page").text().toLowerCase()&&(s+="citazione"),s+="/"+e.find("#value").text(),$.ajax({method:"GET",url:s,data:{ajax:!0}}),$.ajax({method:"POST",url:t+"/templates/ajax/cambia.php",data:{id:a.parent().parent().parent().find("#value").text(),page:$("#page").text()}}).done(function(a){var t=i(e,c,d);$(t).find("#cambia").parent().remove(),$("#change").text(parseInt($("#change").text())-1)})})});